<%= turbo_frame_tag "past_link_preview#{past_link.id}" do %>
  <div class="link-history--card" data-controller="past-reaction">
    <% if past_link.horny? %>
      ğŸ˜
    <% end %>
    <% if past_link.came? %>
      ğŸ’¦
    <% end %>
    <a href="<%= past_link.post_url %>" class="link-history--image-link" target="_blank">
      <%= image_tag past_link.post_thumbnail_url %>
    </a>
    <div class="link-history--card-footer"> 
      <% unless past_link.set_by.nil? %>
        <%= link_to past_link.set_by.username, user_path(past_link.set_by.username), target: '_top', data: { controller: 'user-reference' } %>
      <% else %>
        anon
      <% end %>
      <%= button_tag class: 'no-underline secondary', data: { action: 'click->past-reaction#addReaction' } do %>
        <ion-icon role="presentation" name="happy"></ion-icon>
        <ion-icon role="presentation" name="add"></ion-icon>
      <% end %>
    </div>
    <dialog class="modal link-history--modal" data-past-reaction-target="modal">
      <h4>Previous wallpaper from <%= past_link.set_by&.username || "anon" %></h4>
      <a href="<%= past_link.post_url %>" class="link-history--modal--image-preview" target="_blank">
        <%= image_tag past_link.post_thumbnail_url %>
      </a>

      <% if past_link.response_text %>
        <div class="link--response">
          <strong>
            <%= past_link.link.user.username %>
            <% if past_link.horny? %>
              ğŸ˜:
            <% elsif past_link.came? %>
              ğŸ’¦ said while cumming:
            <% end %>
          </strong>
          <%= past_link.response_text %>
        </div>
      <% end %>
      
      <% if current_user == past_link.link.user%>
        <%= form_with url: url_for(controller: :links, action: :new_reaction, id: past_link.link.id, past_link_id: past_link.id), data: { action:"turbo:submit-end->past-reaction#submitEnd" }, class: 'set-post-response' do |form| %>
          <div>
            <%= form.text_field :response_text, placeholder: 'How do you feel about this wallpaper?', autocomplete: 'off' %>
            <%= form.select :response_type, [['Love it!', :horny], ['Hate it!', :disgust], ['I came', :came]] %>
            <%= form.submit 'Reply' %>
          </div>
        <% end %>
      <% end %>
    </dialog>
  </div>
<% end %>